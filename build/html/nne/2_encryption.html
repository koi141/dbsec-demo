<!doctype html>
<html class="no-js" lang="ja" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="検索" href="../search.html" /><link rel="next" title="1. Data Redactionの準備" href="../redact/1_setup.html" /><link rel="prev" title="1. ネイティブ・ネットワーク暗号化の準備" href="1_setup.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>2. 通信の暗号化を確認する - dbsec-demo ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">dbsec-demo  ドキュメント</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">dbsec-demo  ドキュメント</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="検索" name="q" aria-label="検索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">環境準備:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../env_setup/1_db23ai.html">1. Oracle Database 23ai FREEの準備</a></li>
<li class="toctree-l1"><a class="reference internal" href="../env_setup/2_sampleSchema.html">2. サンプルスキーマ（HR）を作成する</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TDE（透過的データ暗号化）:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tde/1_setup.html">1. TDEの準備</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tde/2_encryption.html">2. TDE 表領域を暗号化する</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ネイティブ・ネットワーク暗号化:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_setup.html">1. ネイティブ・ネットワーク暗号化の準備</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">2. 通信の暗号化を確認する</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Redaction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../redact/1_setup.html">1. Data Redactionの準備</a></li>
<li class="toctree-l1"><a class="reference internal" href="../redact/2_redaction.html">2. Redactionを体験する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../redact/3_note.html">3. Data Redactionの注意点</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Virtual Private Database:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vpd/1_rowControl.html">1. VPDで行制御を行う</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vpd/2_columnControl.html">2. VPDで列制御を行う</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vpd/3_clientIdentifier.html">3. クライアント識別子を用いた制御</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/nne/2_encryption.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="id1">
<h1>2. 通信の暗号化を確認する<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p><strong>実施内容</strong></p>
<ul class="simple">
<li><p>sqlnet.oraファイルを編集し、ネイティブ・ネットワーク暗号化を有効化する</p></li>
<li><p>Wiresharkでパケットが暗号化されているかを確認する</p></li>
</ul>
<section id="db">
<h2>DBサーバー側で通信を待ち受ける<a class="headerlink" href="#db" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">まず、DBサーバー側でポート1521を開放し、通信を受け付ける準備をします。</div>
<div class="line">次のコマンドで、ファイアウォールを設定してポート1521を解放します。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># ポート1521を解放</span>
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--permanent<span class="w"> </span>--add-port<span class="o">=</span><span class="m">1521</span>/tcp
sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--reload

<span class="c1"># インターフェース名と1521番ポートが解放されていることを確認</span>
$<span class="w"> </span>sudo<span class="w"> </span>firewall-cmd<span class="w"> </span>--list-all
public<span class="w"> </span><span class="o">(</span>active<span class="o">)</span>
<span class="w">    </span>target:<span class="w"> </span>default
<span class="w">    </span>icmp-block-inversion:<span class="w"> </span>no
<span class="w">    </span>interfaces:<span class="w"> </span>enp0s5
<span class="w">    </span>sources:
<span class="w">    </span>services:<span class="w"> </span>dhcpv6-client<span class="w"> </span>ssh
<span class="w">    </span>ports:<span class="w"> </span><span class="m">1521</span>/tcp
<span class="w">    </span>protocols:
<span class="w">    </span>forward:<span class="w"> </span>no
<span class="w">    </span>masquerade:<span class="w"> </span>no
<span class="w">    </span>forward-ports:
<span class="w">    </span>source-ports:
<span class="w">    </span>icmp-blocks:
<span class="w">    </span>rich<span class="w"> </span>rules:
</pre></div>
</div>
<div class="line-block">
<div class="line">次に、tsharkコマンドを使ってネットワークインターフェースを確認し、パケットキャプチャを開始します。</div>
<div class="line">先ほど確認したインターフェース名、enp0s5 を使用してTCPポート1521で通信をキャプチャします。</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># インターフェースの番号を確認</span>
$<span class="w"> </span>sudo<span class="w"> </span>tshark<span class="w"> </span>-D
Running<span class="w"> </span>as<span class="w"> </span>user<span class="w"> </span><span class="s2">&quot;root&quot;</span><span class="w"> </span>and<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;root&quot;</span>.<span class="w"> </span>This<span class="w"> </span>could<span class="w"> </span>be<span class="w"> </span>dangerous.
<span class="m">1</span>.<span class="w"> </span>enp0s5
<span class="m">2</span>.<span class="w"> </span>lo<span class="w"> </span><span class="o">(</span>Loopback<span class="o">)</span>
<span class="m">3</span>.<span class="w"> </span>any
<span class="m">4</span>.<span class="w"> </span>bluetooth-monitor
<span class="m">5</span>.<span class="w"> </span>nflog
<span class="m">6</span>.<span class="w"> </span>nfqueue
<span class="m">7</span>.<span class="w"> </span>usbmon0
<span class="m">8</span>.<span class="w"> </span>usbmon1
<span class="m">9</span>.<span class="w"> </span>usbmon2
<span class="m">10</span>.<span class="w"> </span>usbmon3
...

<span class="c1"># TCP/1521で受け取る通信をキャプチャ</span>
$<span class="w"> </span>sudo<span class="w"> </span>tshark<span class="w"> </span>-i<span class="w"> </span><span class="m">1</span><span class="w"> </span>-Y<span class="w"> </span><span class="s1">&#39;tcp.port==1521&#39;</span><span class="w"> </span>-x
</pre></div>
</div>
<p>これで、DBサーバー側での通信がキャプチャされるようになります。次に、クライアント側でDBに接続します。</p>
</section>
<section id="id2">
<h2>クライアント側でDBに接続する<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>簡易接続子を使って、SQL*PlusでOracleデータベースに接続します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sqlplus</span> <span class="n">hr</span><span class="o">/&lt;</span><span class="n">パスポート</span><span class="o">&gt;@&lt;</span><span class="n">接続先ホスト名</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">ポート番号</span><span class="o">&gt;/&lt;</span><span class="n">サービス名</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>以下のコマンドで、HRユーザーとして接続します。実行例ではパスワードを省略することで証跡にパスワードが残らないように接続しています。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sqlplus<span class="w"> </span>hr@192.168.130.169:1521/freepdb1

SQL*Plus:<span class="w"> </span>Release<span class="w"> </span><span class="m">21</span>.0.0.0.0<span class="w"> </span>-<span class="w"> </span>Production<span class="w"> </span>on<span class="w"> </span>Tue<span class="w"> </span>Nov<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">22</span>:09:52<span class="w"> </span><span class="m">2024</span>
Version<span class="w"> </span><span class="m">21</span>.11.0.0.0

Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">1982</span>,<span class="w"> </span><span class="m">2022</span>,<span class="w"> </span>Oracle.<span class="w">  </span>All<span class="w"> </span>rights<span class="w"> </span>reserved.

Enter<span class="w"> </span>password:<span class="w"> </span>&lt;パスワードを入力&gt;
Last<span class="w"> </span>Successful<span class="w"> </span>login<span class="w"> </span>time:<span class="w"> </span>Tue<span class="w"> </span>Nov<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span><span class="m">22</span>:08:58<span class="w"> </span>+09:00

Connected<span class="w"> </span>to:
Oracle<span class="w"> </span>Database<span class="w"> </span>23ai<span class="w"> </span>Free<span class="w"> </span>Release<span class="w"> </span><span class="m">23</span>.0.0.0.0<span class="w"> </span>-<span class="w"> </span>Develop,<span class="w"> </span>Learn,<span class="w"> </span>and<span class="w"> </span>Run<span class="w"> </span><span class="k">for</span><span class="w"> </span>Free
Version<span class="w"> </span><span class="m">23</span>.6.0.24.10

--<span class="w"> </span>適当なSQLを発行
SQL&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>jobs<span class="p">;</span>

JOB_ID<span class="w">     </span>JOB_TITLE<span class="w">                           </span>MIN_SALARY<span class="w"> </span>MAX_SALARY
----------<span class="w"> </span>-----------------------------------<span class="w"> </span>----------<span class="w"> </span>----------
AD_PRES<span class="w">    </span>President<span class="w">                                </span><span class="m">20080</span><span class="w">      </span><span class="m">40000</span>
AD_VP<span class="w">      </span>Administration<span class="w"> </span>Vice<span class="w"> </span>President<span class="w">            </span><span class="m">15000</span><span class="w">      </span><span class="m">30000</span>
AD_ASST<span class="w">    </span>Administration<span class="w"> </span>Assistant<span class="w">                  </span><span class="m">3000</span><span class="w">     </span><span class="m">6000</span>
FI_MGR<span class="w">     </span>Finance<span class="w"> </span>Manager<span class="w">                           </span><span class="m">8200</span><span class="w">      </span><span class="m">16000</span>
FI_ACCOUNT<span class="w"> </span>Accountant<span class="w">                                </span><span class="m">4200</span><span class="w">     </span><span class="m">9000</span>
AC_MGR<span class="w">     </span>Accounting<span class="w"> </span>Manager<span class="w">                        </span><span class="m">8200</span><span class="w">      </span><span class="m">16000</span>
...
</pre></div>
</div>
<p>この時点で、DBサーバーでパケットキャプチャを実行している端末を見ると、jobs テーブルの内容が平文で送信されていることが確認できます。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>（一部抜粋）
...
0080  2c 01 04 05 41 44 5f 56 50 1d 41 64 6d 69 6e 69   ,...AD_VP.Admini
0090  73 74 72 61 74 69 6f 6e 20 56 69 63 65 20 50 72   stration Vice Pr
00a0  65 73 69 64 65 6e 74 03 c3 02 33 02 c3 04 07 2a   esident...3....*
00b0  2c 01 04 07 41 44 5f 41 53 53 54 18 41 64 6d 69   ,...AD_ASST.Admi
00c0  6e 69 73 74 72 61 74 69 6f 6e 20 41 73 73 69 73   nistration Assis
00d0  74 61 6e 74 02 c2 1f 02 c2 3d 07 21 2c 01 04 06   tant.....=.!,...
00e0  46 49 5f 4d 47 52 0f 46 69 6e 61 6e 63 65 20 4d   FI_MGR.Finance M
00f0  61 6e 61 67 65 72 02 c2 53 03 c3 02 3d 07 1f 2c   anager..S...=..,
0100  01 04 0a 46 49 5f 41 43 43 4f 55 4e 54 0a 41 63   ...FI_ACCOUNT.Ac
0110  63 6f 75 6e 74 61 6e 74 02 c2 2b 02 c2 5b 07 24   countant..+..[.$
0120  2c 01 04 06 41 43 5f 4d 47 52 12 41 63 63 6f 75   ,...AC_MGR.Accou
0130  6e 74 69 6e 67 20 4d 61 6e 61 67 65 72 02 c2 53   nting Manager..S
0140  03 c3 02 3d 07 26 2c 01 04 0a 41 43 5f 41 43 43   ...=.&amp;,...AC_ACC
0150  4f 55 4e 54 11 50 75 62 6c 69 63 20 41 63 63 6f   OUNT.Public Acco
0160  75 6e 74 61 6e 74 02 c2 2b 02 c2 5b 07 20 2c 01   untant..+..[. ,.
0170  04 06 53 41 5f 4d 41 4e 0d 53 61 6c 65 73 20 4d   ..SA_MAN.Sales M
0180  61 6e 61 67 65 72 02 c3 02 04 c3 03 01 51 07 27   anager.......Q.&#39;
0190  2c 01 04 06 53 41 5f 52 45 50 14 53 61 6c 65 73   ,...SA_REP.Sales
01a0  20 52 65 70 72 65 73 65 6e 74 61 74 69 76 65 02    Representative.
01b0  c2 3d 04 c3 02 15 09 07 24 2c 01 04 06 50 55 5f   .=......$,...PU_
01c0  4d 41 4e 12 50 75 72 63 68 61 73 69 6e 67 20 4d   MAN.Purchasing M
01d0  61 6e 61 67 65 72 02 c2 51 03 c3 02 33 07 23 2c   anager..Q...3.#,
01e0  01 04 08 50 55 5f 43 4c 45 52 4b 10 50 75 72 63   ...PU_CLERK.Purc
01f0  68 61 73 69 6e 67 20 43 6c 65 72 6b 02 c2 1a 02   hasing Clerk....
0200  c2 38 07 1e 2c 01 04 06 53 54 5f 4d 41 4e 0d 53   .8..,...ST_MAN.S
...
</pre></div>
</div>
<div class="line-block">
<div class="line">この状態では、データが平文でネットワーク上に送信されており、暗号化が行われていないことが確認できます。</div>
<div class="line">それでは、次の手順で通信の暗号化を設定します。</div>
</div>
</section>
<section id="id3">
<h2>通信の暗号化設定を行う<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>DBサーバーの <code class="docutils literal notranslate"><span class="pre">$ORACLE_HOME/network/admin</span></code> にある <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> ファイルを編集し、通信の暗号化を有効化します。</p>
<p>まず、 <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> ファイルの場所を確認します。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>ls<span class="w"> </span><span class="nv">$ORACLE_HOME</span>/network/admin
listener.ora<span class="w">  </span>samples<span class="w">  </span>shrept.lst<span class="w">  </span>sqlnet.ora<span class="w">  </span>tnsnames.ora
</pre></div>
</div>
<p>次に、 <code class="docutils literal notranslate"><span class="pre">sqlnet.ora</span></code> を編集して、暗号化を有効にします。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>vi<span class="w"> </span><span class="nv">$ORACLE_HOME</span>/network/admin/sqlnet.ora
NAMES.DIRECTORY_PATH<span class="o">=</span><span class="w"> </span><span class="o">(</span>TNSNAMES,<span class="w"> </span>EZCONNECT<span class="o">)</span>

<span class="c1"># 以下の2行を追加</span>
<span class="hll">SQLNET.ENCRYPTION_SERVER<span class="w"> </span><span class="o">=</span><span class="w"> </span>REQUIRED
</span><span class="hll">SQLNET.ENCRYPTION_TYPES_SERVER<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span>AES256,<span class="w"> </span>AES192,<span class="w"> </span>AES128<span class="o">)</span>
</span></pre></div>
</div>
<p>この設定により、データベースとの通信が暗号化されるようになります。</p>
<p>sudo rpm -ivh oracle.mgmt_agent.241023.2127.Linux-x86_64.rpm --preserve-env=JAVA_HOME</p>
</section>
<section id="id4">
<h2>暗号化設定後、再びDBに接続する<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>クライアント側で再びDBに接続し、先ほどと同様に問い合わせを行います。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>sqlplus<span class="w"> </span>hr@192.168.130.169:1521/freepdb1

SQL*Plus:<span class="w"> </span>Release<span class="w"> </span><span class="m">21</span>.0.0.0.0<span class="w"> </span>-<span class="w"> </span>Production<span class="w"> </span>on<span class="w"> </span>Tue<span class="w"> </span>Nov<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">22</span>:09:52<span class="w"> </span><span class="m">2024</span>
Version<span class="w"> </span><span class="m">21</span>.11.0.0.0

Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">1982</span>,<span class="w"> </span><span class="m">2022</span>,<span class="w"> </span>Oracle.<span class="w">  </span>All<span class="w"> </span>rights<span class="w"> </span>reserved.

Enter<span class="w"> </span>password:<span class="w"> </span>&lt;パスワードを入力&gt;
Last<span class="w"> </span>Successful<span class="w"> </span>login<span class="w"> </span>time:<span class="w"> </span>Tue<span class="w"> </span>Nov<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">2024</span><span class="w"> </span><span class="m">22</span>:08:58<span class="w"> </span>+09:00

Connected<span class="w"> </span>to:
Oracle<span class="w"> </span>Database<span class="w"> </span>23ai<span class="w"> </span>Free<span class="w"> </span>Release<span class="w"> </span><span class="m">23</span>.0.0.0.0<span class="w"> </span>-<span class="w"> </span>Develop,<span class="w"> </span>Learn,<span class="w"> </span>and<span class="w"> </span>Run<span class="w"> </span><span class="k">for</span><span class="w"> </span>Free
Version<span class="w"> </span><span class="m">23</span>.6.0.24.10

--<span class="w"> </span>適当なSQLを発行
SQL&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>jobs<span class="p">;</span>

JOB_ID<span class="w">     </span>JOB_TITLE<span class="w">                           </span>MIN_SALARY<span class="w"> </span>MAX_SALARY
----------<span class="w"> </span>-----------------------------------<span class="w"> </span>----------<span class="w"> </span>----------
AD_PRES<span class="w">    </span>President<span class="w">                                </span><span class="m">20080</span><span class="w">      </span><span class="m">40000</span>
AD_VP<span class="w">      </span>Administration<span class="w"> </span>Vice<span class="w"> </span>President<span class="w">            </span><span class="m">15000</span><span class="w">      </span><span class="m">30000</span>
AD_ASST<span class="w">    </span>Administration<span class="w"> </span>Assistant<span class="w">                  </span><span class="m">3000</span><span class="w">     </span><span class="m">6000</span>
FI_MGR<span class="w">     </span>Finance<span class="w"> </span>Manager<span class="w">                           </span><span class="m">8200</span><span class="w">      </span><span class="m">16000</span>
FI_ACCOUNT<span class="w"> </span>Accountant<span class="w">                                </span><span class="m">4200</span><span class="w">     </span><span class="m">9000</span>
AC_MGR<span class="w">     </span>Accounting<span class="w"> </span>Manager<span class="w">                        </span><span class="m">8200</span><span class="w">      </span><span class="m">16000</span>
...
</pre></div>
</div>
<p>Wiresharkでのキャプチャを確認すると、データが平文ではなく、暗号化されていることが確認できます。</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>（一部抜粋）
...
0140  41 d7 65 ec 53 50 c4 46 10 a4 08 e4 30 9b 68 7f   A.e.SP.F....0.h.
0150  2c 19 28 2c 5d 58 09 f4 7a c6 16 5f 8e 6a 42 1d   ,.(,]X..z.._.jB.
0160  e0 7a 69 f9 eb 86 96 44 36 5e c6 81 e8 cb 48 61   .zi....D6^....Ha
0170  44 e1 02 61 ca 47 ce d0 58 df 2c be 3b cb 02 36   D..a.G..X.,.;..6
0180  05 a8 1f 4f e8 d9 be 71 da ac 67 36 e0 65 9d 4b   ...O...q..g6.e.K
0190  e3 8f ef d3 5f 30 fa 74 24 fa 6c b8 5e 87 71 c1   ...._0.t$.l.^.q.
01a0  67 af 2e e5 b3 e4 4a e8 c7 c6 dc 61 11 22 b4 69   g.....J....a.&quot;.i
01b0  68 42 f3 e9 da 80 ad 5e d6 7b 75 f3 10 53 04 77   hB.....^.{u..S.w
01c0  8c 62 68 2c e8 ab 9b 4e 6f 54 4b ec fa fb 5a ed   .bh,...NoTK...Z.
01d0  61 63 97 27 74 a5 d5 1f ce 54 b8 56 d8 a3 c0 e1   ac.&#39;t....T.V....
01e0  a4 1e ca 5f 39 0c 1e ec 3e 23 57 a1 a4 a2 c6 2b   ..._9...&gt;#W....+
01f0  c1 27 04 07 4f 0e 10 ac 13 ff b0 ae 31 48 a8 26   .&#39;..O.......1H.&amp;
0200  df 6e 68 dc fd 17 36 db 4d 07 ad 11 af e3 ff 80   .nh...6.M.......
0210  d1 5e cf ab 61 f9 57 36 6f 98 52 d0 49 29 13 57   .^..a.W6o.R.I).W
0220  8d 21 32 1d 40 cb d0 a2 96 70 db 13 ae 35 0d ec   .!2.@....p...5..
...
</pre></div>
</div>
<p>このように通信が確実に暗号化されていることが確認できます。</p>
<p>以上で、ネイティブ・ネットワーク暗号化のデモは終了です。</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../redact/1_setup.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">1. Data Redactionの準備</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="1_setup.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">1. ネイティブ・ネットワーク暗号化の準備</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, koi141
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">2. 通信の暗号化を確認する</a><ul>
<li><a class="reference internal" href="#db">DBサーバー側で通信を待ち受ける</a></li>
<li><a class="reference internal" href="#id2">クライアント側でDBに接続する</a></li>
<li><a class="reference internal" href="#id3">通信の暗号化設定を行う</a></li>
<li><a class="reference internal" href="#id4">暗号化設定後、再びDBに接続する</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=c033477b"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/translations.js?v=4755f45a"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    </body>
</html>